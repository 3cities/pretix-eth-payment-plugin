(()=>{"use strict";const e={paymentDetails:null,transactionHashSubmitted:!1,lastOrderStatus:"",elements:{divError:document.getElementById("message-error"),divSuccess:document.getElementById("success"),divTransactionHash:document.getElementById("pretix-eth-transaction-hash"),aOrderDetailURL:document.getElementById("pretix-order-detail-url"),buttonPay:document.getElementById("btn-pay"),submittedTransactionHash:document.getElementById("pretix-eth-submitted-transaction-hash")},selectors:{paymentSteps:document.querySelectorAll(".pretix-eth-payment-steps")}};function t(){return e.elements.buttonPay.getAttribute("data-transaction-details-url")}function n(e){e+="=";const t=decodeURIComponent(document.cookie).split(";");for(let n=0;n<t.length;n++){const a=t[n].trim();if(0==a.indexOf(e))return a.substring(e.length,a.length)}}function a(t="",n=!0){e.transactionHashSubmitted?(t="",n=!1):("object"==typeof t&&(t=t.data&&t.data.message?t.data.message+". Please try again.":void 0!==t.message?t.message+". Please try again.":void 0!==t.error&&void 0!==t.error.message?t.error.message+". Please try again.":""),""===t&&(t="There was an error, please try again, or contact support if you have already confirmed a payment in your wallet provider.")),e.elements.divError.innerHTML=t,!0===n&&i("pay");try{e.elements.buttonPay.removeAttribute("disabled")}catch(e){return!1}return!1}function i(t){e.selectors.paymentSteps.forEach((function(e){e.id===t?e.style.display="block":e.style.display="none"}))}async function r(){let t=e.elements.aOrderDetailURL.getAttribute("data-order-detail-url");const a=n("pretix_csrftoken");let i=await fetch(t,{headers:{"X-CSRF-TOKEN":a,"HTTP-X-CSRFTOKEN":a}});if(i.ok){let t=await i.json();""===e.lastOrderStatus?e.lastOrderStatus=t.status:e.lastOrderStatus!==t.status&&"p"===t.status&&location.reload()}}let o;async function s(){e.elements.divError.innerHTML="";try{await async function(){e.paymentDetails=await async function(n=!1){if(!n&&null!==e.paymentDetails)return e.paymentDetails;const a=await fetch(t());if(a.status>=400)throw"Failed to fetch order details. If this problem persists, please contact the organizer directly.";return await a.json()}(!0),!0!==e.paymentDetails.is_signature_submitted?function({tcBaseUrl:e,paymentLogicalAssetAmountInUsd:t,onCheckout:n}){!function({tcOrigin:e,onCheckout:t}){o&&(window.removeEventListener("message",o,!0),o=void 0),o=n=>{n.origin===e&&(null!==n&&"object"==typeof n&&null!==n.data&&"object"==typeof n.data?"Checkout"===n.data.kind?t(n.data):console.error("Unexpected kind of event from 3cities, kind=",n.data.kind):console.error("Unexpected event from 3cities",n))},window.addEventListener("message",o,!0)}({tcOrigin:new URL(e).origin,onCheckout:n});const a='Standalone page detected. Please use the "Click here to pay" pop-up in Pretix',i=window.location.origin,r={verifyEip1271Signature:!0},s=(()=>{const n=[e];return n.push(`&amount=${t}`),a&&n.push(`&requireInIframeOrErrorWith=${encodeURIComponent(a)}`),i&&n.push(`&requireIframeParentOrigin=${encodeURIComponent(i)}`),r&&(n.push("&verifyAddressOwnership=1"),r.verifyEip1271Signature&&n.push("&verifyEip1271Signature=1")),n.join("")})();var d;d=s,function(){let e=document.createElement("div");e.style="position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;",e.onclick=function(n){n.target===e&&t()};let t=function(){document.body.contains(e)&&(document.body.removeChild(e),document.removeEventListener("keydown",n))},n=function(e){"Escape"===e.key&&t()};document.addEventListener("keydown",n);let a=document.createElement("div"),i=window.innerWidth<420?window.innerWidth-30+"px":"390px";a.style="background-color:#f1f1f1;padding:8px;width:100%;max-width:"+i+";height:95vh;max-height:1024px;border-radius:10px;position:relative;box-shadow:0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);margin:auto;";let r=document.createElement("iframe");r.style="width:100%;height:100%;border:0;",r.src=d;let o=document.createElement("div");o.style="position:absolute;top:5px;right:5px;width:24px;height:24px;cursor:pointer;z-index:10;",o.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='currentColor' style='width:100%;height:100%;'><path fill-rule='evenodd' clip-rule='evenodd' d='M10 9.293l5.146-5.147a.5.5 0 01.708.708L10.707 10l5.147 5.146a.5.5 0 01-.708.708L10 10.707l-5.146 5.147a.5.5 0 01-.708-.708L9.293 10 4.146 4.854a.5.5 0 11.708-.708L10 9.293z'></path></svg>",o.onclick=function(){t()},a.appendChild(r),a.appendChild(o),e.appendChild(a),document.body.appendChild(e)}()}({tcBaseUrl:"http://localhost:3000/#/pay?c=CAESFKwNd1PqKBZQG1f66a1mVzkBg4SzIgICASoCARJaDkRldmNvbiB0aWNrZXRz",paymentLogicalAssetAmountInUsd:e.paymentDetails.amount,onCheckout:d}):a("It seems that you have paid for this order already.")}()}catch(e){console.error("Pay flow error:",e),a(e,!0)}}async function d(o){try{await async function(o){const s=n("pretix_csrftoken"),d=t(),c=new URLSearchParams({csrfmiddlewaretoken:s,senderAddress:o.message.senderAddress,signature:o.signature,message:JSON.stringify(o.message),transactionHash:o.transactionHash,chainId:o.chainId});fetch(d,{headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-TOKEN":s,"HTTP-X-CSRFTOKEN":s},method:"POST",body:c}).then((async t=>{t.ok?(function(t){e.transactionHashSubmitted=!0,e.elements.divTransactionHash.innerHTML=`${t.transactionHash} (chain ID ${t.chainId})`,i(),e.elements.divSuccess.style.display="block"}(o),await async function(){for(;;){try{await r()}catch(e){}await new Promise((e=>setTimeout(e,5e3)))}}()):a(`There was an error processing your payment, please contact support. Your payment was sent in transaction ${o.transactionHash} on chainId ${o.chainId}.`,!1)}))}(o)}catch(e){a(e,!0)}}!async function(){document.title="Pretix Payment",document.getElementById("spinner").style.display="none";const e=document.getElementById("btn-pay");e?e.addEventListener("click",s):console.error("No pay button found")}()})();
//# sourceMappingURL=web3modal.97e18fd84746833f0046.js.map